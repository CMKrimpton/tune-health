---
/**
 * SEO Component - Generates JSON-LD structured data for rich search results
 * Supports Article, WebSite, Organization, and BreadcrumbList schemas
 */

interface ArticleData {
  title: string;
  description: string;
  publishDate: string;
  updatedDate?: string;
  author: string;
  category: string;
  tags?: string[];
  readTime?: number;
  wordCount?: number;
}

interface Props {
  type: 'website' | 'article';
  article?: ArticleData;
}

const { type, article } = Astro.props;

const siteUrl = 'https://tune-health.vercel.app';
const siteName = 'Tune Health';
const logo = `${siteUrl}/assets/logo.png`;

// Organization schema (always included)
const organizationSchema = {
  '@type': 'Organization',
  '@id': `${siteUrl}/#organization`,
  name: siteName,
  url: siteUrl,
  logo: {
    '@type': 'ImageObject',
    url: logo,
  },
  sameAs: [],
};

// Website schema (always included)
const websiteSchema = {
  '@type': 'WebSite',
  '@id': `${siteUrl}/#website`,
  url: siteUrl,
  name: siteName,
  publisher: {
    '@id': `${siteUrl}/#organization`,
  },
  potentialAction: {
    '@type': 'SearchAction',
    target: `${siteUrl}/?s={search_term_string}`,
    'query-input': 'required name=search_term_string',
  },
};

// Build the schema graph
const schemaGraph: any[] = [organizationSchema, websiteSchema];

// Add article-specific schemas
if (type === 'article' && article) {
  const articleUrl = Astro.url.href;

  // Breadcrumb schema
  const breadcrumbSchema = {
    '@type': 'BreadcrumbList',
    '@id': `${articleUrl}#breadcrumb`,
    itemListElement: [
      {
        '@type': 'ListItem',
        position: 1,
        item: {
          '@id': siteUrl,
          name: 'Home',
        },
      },
      {
        '@type': 'ListItem',
        position: 2,
        item: {
          '@id': `${siteUrl}/articles`,
          name: 'Articles',
        },
      },
      {
        '@type': 'ListItem',
        position: 3,
        item: {
          '@id': articleUrl,
          name: article.title,
        },
      },
    ],
  };

  // Article schema
  const articleSchema = {
    '@type': 'Article',
    '@id': `${articleUrl}#article`,
    isPartOf: {
      '@id': `${siteUrl}/#website`,
    },
    author: {
      '@type': 'Organization',
      name: article.author,
      url: siteUrl,
    },
    headline: article.title,
    description: article.description,
    datePublished: article.publishDate,
    dateModified: article.updatedDate || article.publishDate,
    mainEntityOfPage: {
      '@id': articleUrl,
    },
    publisher: {
      '@id': `${siteUrl}/#organization`,
    },
    articleSection: article.category,
    keywords: article.tags?.join(', '),
    ...(article.wordCount && { wordCount: article.wordCount }),
    ...(article.readTime && {
      timeRequired: `PT${article.readTime}M`,
    }),
  };

  // WebPage schema
  const webPageSchema = {
    '@type': 'WebPage',
    '@id': articleUrl,
    url: articleUrl,
    name: article.title,
    description: article.description,
    isPartOf: {
      '@id': `${siteUrl}/#website`,
    },
    breadcrumb: {
      '@id': `${articleUrl}#breadcrumb`,
    },
    about: {
      '@type': 'Thing',
      name: article.category,
    },
    datePublished: article.publishDate,
    dateModified: article.updatedDate || article.publishDate,
  };

  schemaGraph.push(breadcrumbSchema, articleSchema, webPageSchema);
}

// Build the final JSON-LD
const jsonLd = {
  '@context': 'https://schema.org',
  '@graph': schemaGraph,
};
---

<script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
